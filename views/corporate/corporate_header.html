<!DOCTYPE html>
<html lang="en">

<head>
    <!-- META SECTION -->
    <title>
        <%= setting_detail.corporate_panel_name %>
    </title>
    <script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap/bootstrap.min.js"></script>
    <script type='text/javascript' src='js/plugins/icheck/icheck.min.js'></script>
    <script type="text/javascript" src="js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"></script>
    <script type="text/javascript" src="js/actions.js"></script>
    <script type='text/javascript' src='js/plugins/jquery-validation/jquery.validate.js'></script>
    <script type="text/javascript" src="js/validation.js"></script>

    <style type="text/css" media="screen">
                #cover-spin {
                position:fixed;
                width:100%;
                left:0;right:0;top:0;bottom:0;
                background-color: rgba(0,0,0,0.2);
                z-index:9999;
                display:none;
            }

            @-webkit-keyframes spin {
                from {-webkit-transform:rotate(0deg);}
                to {-webkit-transform:rotate(360deg);}
            }

            @keyframes spin {
                from {transform:rotate(0deg);}
                to {transform:rotate(360deg);}
            }

            #cover-spin::after {
                content:'';
                display:block;
                position:absolute;
                left:50%;top:50%;
                width:40px;height:40px;
                border-style:solid;
                border-color:black;
                border-top-color:transparent;
                border-width: 4px;
                border-radius:50%;
                -webkit-animation: spin .8s linear infinite;
                animation: spin .8s linear infinite;
            }
        @media screen and (max-width: 500px)  {
            .page-container .page-content .page-content-wrap{
                padding-top: 65px !important;
            }   
        }
        @media screen and (max-width: 991px)  {
            .new_req_btn{
                top:200px !important;
                right: 50px !important;
            }
        }
        
        .x-navigation button,a{
            word-break: break-all;
            overflow: hidden !important;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .x-navigation a{
            padding-right: 1rem!important;
        }

        .x-navigation button:hover,.x-navigation a:hover{
            overflow: visible; 
            white-space: normal;
            height:auto;  /* just added this line */
            padding-right: 1rem!important;
        }

        .x-navigation-minimized a{
            overflow: unset !important;
        }
		.page_title_li{
			width: 65% !important;
		}

        #languageId{
            width: unset !important;
            height: unset !important;
            border: unset !important;
            padding: unset !important;
            outline: unset !important;
            background: #e1e1e1;
            font-size: unset !important;
            font-weight: unset !important;
            font-family: "Helvetica Neue",Helvetica,Arial,sans-serif !important;
            border-radius: unset !important;
            margin-bottom: unset !important;
            color: #656d78 !important;
        }

        .background{
            background-color: #250e62;
        }
        #inbox-icon{
            position: relative;
            font-size: 37px;
        }
        .notificationBadge {
            position: absolute;
            top: 10px;
            right: -8px;
            background-color: #00BFB3;
            color: white;
            border-radius: 50%;
            padding: 3px 6px;
            font-size: 13px;
            font-weight: bold;
            line-height: 1;
            border: 1px solid #aed5ff;
        }    

    </style>

    <script type="text/javascript">
        $('.is_hide_amount_class').hide();
        $(document).ready(function(){
            var path = window.location.pathname;
            var value = path.split('/');

            $('#'+value[1]).addClass('active');
            var page_title = $('#'+value[1]).text();

            $('#page_title').text(page_title);

            if(path == "/corporate_create_trip"){
                $('#page-container').addClass("page-navigation-toggled")
                $('#page-container').addClass("page-container-wide")
                $('#x-navigation').addClass("x-navigation-minimized")
            }

            $.ajax({
                type: 'POST',
                url: '/session_data',
                data: {'type': 'corporate'},
                dataType: "json",
                success:function(response){
                    updateWhatsAppNumber(response.session_data.country_name)
                    $('option[value=' + response.cookies + ']').attr('selected',true);
                    $('.profile-data-name').html(response.session_data.company_name);
                    $('#corporate-profile').attr('src', response.session_data.picture != '' ? "<%=setting_detail.image_base_url %>"+response.session_data.picture : 'default.png');
                    if(response.success){

                        if(response.cookies){
                            $('option[value=' + response.cookies + ']').attr('selected',true);
                        } else {
                            $('option[value=en]').attr('selected',true);
                        }
                        
                        if(!response.session_data) {
                            window.location.href = 'corporate';
                        }
                        
                        if(response.session_data.country_phone_code != "+58"){
                            $('#corporate_ferry_tickets').hide();
                        }

                        if (response.session_data.corporate_type_id) {
                            let corporate = response.session_data
                            console.log({corporate: corporate?.is_hide_amount})
                            if(corporate?.is_hide_amount == 1){
                                $('.is_hide_amount_class').hide();
                            }else{
                                $('.is_hide_amount_class').show();

                            }
                            $('#sub_corporate_users').hide();
                            var index = response.session_data.url_array.indexOf(value[1]);
                            if (index == -1 && value[1] != 'corporate_profile') {
                                const allowedPages = ['corporate_trip_map', 'trip_invoice', 'corporate_statistics', 'corporate_edit_trip', 'corporate_profile'];
                                if (process.env.INTEGRATION_NEW_TRAVEL === 'true') {
                                    allowedPages.push('corporate_profile_old');
                                }
                                if(!allowedPages.includes(value[1])){
                                    window.location.href = 'corporate_profile';
                                }
                            }
                            $('#corporate_btn_hide').hide();
                            $('.corporate_btn_hide').hide();
                            if (response.session_data.url_array.indexOf('corporate_statistics_facturado') == -1) {
                                $('.corporate_statistics_facturado').hide();
                            }
                            if (response.session_data.url_array.indexOf('corporate_create_trip') == -1) {
                                $('#corporate_create_trip').hide();
                            }
                            if (response.session_data.url_array.indexOf('corporate_map_view') == -1) {
                                $('#corporate_map_view').hide();
                            }
                            if (response.session_data.url_array.indexOf('corporate_request') == -1) {
                                $('#corporate_request').hide();
                            }
                            if (response.session_data.url_array.indexOf('corporate_history') == -1) {
                                $('#corporate_history').hide();
                            }
                            if (response.session_data.url_array.indexOf('corporate_future_request') == -1) {
                                $('#corporate_future_request').hide();
                            }
                            if (response.session_data.url_array.indexOf('corporate_users') == -1) {
                                $('#corporate_users').hide();
                            }

                            if (response.session_data.url_array.indexOf('corporate_payments') == -1) {
                                $('#corporate_payments').hide();
                            }
                        }else{
                            $('#is_hide_amount_class').show();
                        }
                        const advertise_urls = <%- JSON.stringify(setting_detail.advertise_urls) %>;
                        const advertise_data = advertise_urls.find(obj => obj.country_id.toString() === response.session_data.country_id.toString());

                        let advertise_url = "";
                        if (advertise_data) {
                            advertise_url = advertise_data.flety_corporate_ads_url;
                            $('#web_advertise').attr('src', "<%=setting_detail.image_base_url %>" + advertise_url);
                        }

                    } else {
                        window.location = 'corporate_login'
                    }

                }
            });

            $("#languageId").change(function () {
                $.ajax({
                    type: 'POST',
                    url: '/change_language',
                    data: { 'language': this.value },
                    dataType: "json",
                    success: function (response) {
                        console.log(response)
                        window.location.reload();
                    }
                })
            });
            $.ajax({
                type: 'POST',
                url: '/get_inbox_notifications_list',
                data: { 'type': '<%= constant_json.CORPORATE_UNIQUE_NUMBER %>' },
                dataType: "json",
                success:function(response){
                    let mass_notifications =  response?.notifications || []
                    let unreadCount = mass_notifications.filter(notification => !notification.is_read).length;
                    $('.notificationBadge').text(unreadCount);
                }
            })

        });
        function updateWhatsAppNumber(countryName) {
            let fletyPhone = 584126435389;
            if (countryName === "Panama") {
                fletyPhone = 50765556385;
            }
            const whatsappLink = `https://api.whatsapp.com/send/?phone=${fletyPhone}&text=¡Hola+Flety!+Quiero+cotizar+un+flete&type=phone_number&app_absent=0`;
            $(".wp").attr("href", whatsappLink);
        }

    </script>

    <% include header_title.html %>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />


    <link rel="icon" href="web_images/favicons/FLETY_ICONOCLIENTES.png" type="image/x-icon" />
    <!-- END META SECTION -->

    <!-- CSS INCLUDE -->
    <link rel="stylesheet" type="text/css" href="css/theme-default.css" />
    <link rel="stylesheet" type="text/css" href="css/map.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />

    <!-- EOF CSS INCLUDE -->

</head>

<body>
    <!-- START PAGE CONTAINER -->
    <div class="page-container" id="page-container">
        <!-- START PAGE SIDEBAR -->
        <div class="page-sidebar background">
            <!-- START X-NAVIGATION -->
            <ul class="x-navigation" id="x-navigation">
                
                <li>
                        <a style="text-align: center; margin-bottom: 4px;">
                        </a>

                    <a href="#" class="x-navigation-control"></a>
                </li>
                <li class="xn-profile">

                    <div class="profile">
                        <div class="profile-image">
                            <img id="corporate-profile" />
                        </div>
                        <div class="profile-data">
                            <div class="profile-data-name">
                            </div>
                        </div>

                    </div>

                </li>
                <ul id="menu-item">
                    <li id="corporate_profile">
                        <a href="/corporate_profile"><span><i class="fa fa-users"></i></span> <span class="xn-text"><%= __('menu_title_profile') %></span></a>
                    </li>
                    <li id="corporate_statistics">
                        <a href="/corporate_statistics"><span><i class="fa fa-line-chart"></i></span> <span class="xn-text"><%= __('menu_title_statistics') %></span></a>
                    </li>
                    <li id="corporate_map_view">
                        <a href="/corporate_map_view"><span><i class="fa fa-map-marker"></i></span> <span class="xn-text"><%= __('menu_title_map_view') %></span></a>
                    </li>
                    <li id="corporate_create_trip">
                        <a href="/corporate_create_trip"><span><i class="fa fa-calendar-plus-o"></i></span> <span class="xn-text"><%= __('menu_title_create_requests') %></span></a>
                    </li>
                    <li id="corporate_request">
                        <a href="/corporate_request"><span><i class="fa fa-paper-plane"></i></span> <span class="xn-text"><%= __('sub_menu_title_running_requests') %></span></a>
                    </li>
                    <li id="corporate_history">
                        <a href="/corporate_history"><span><i class="fa fa-calendar"></i></span> <span class="xn-text"><%= __('sub_menu_title_completed_requests') %></span></a>
                    </li>
                    <li id="corporate_future_request">
                        <a href="/corporate_future_request"><span><i class="fa fa-calendar-o"></i></span> <span class="xn-text"><%= __('menu_title_future_requests') %></span></a>
                    </li>
                    <li id="corporate_ferry_tickets">
                        <a href="/corporate_ferry_tickets"><span><i class="fa fa-calendar-o"></i></span> <span class="xn-text"><%= __('menu_title_ferry_tickets') %></span></a>
                    </li>

                    <li id="corporate_users">
                        <a href="/corporate_users"><span><i class="fa fa-user"></i></span> <span class="xn-text"><%= __('menu_title_users') %></span></a>
                    </li>          
                    <li id="sub_corporate_users">
                        <a href="/sub_corporate_users"><span><i class="fa fa-user"></i></span> <span class="xn-text"><%= __('menu_title_sub_corporate_users') %></span></a>
                    </li>                              
                    <li id="corporate_sign_out">
                        <% if (process.env.INTEGRATION_NEW_TRAVEL === 'true') { %>
                            <a href="<%= process.env.NEW_LOGIN %>"><span><i class="fa fa-power-off"></i></span> <span class="xn-text"><%= __('button_logout') %></span></a>
                        <% } else { %>
                            <a href="/corporate_sign_out"><span><i class="fa fa-power-off"></i></span> <span class="xn-text"><%= __('button_logout') %></span></a>
                        <% } %>
                    </li>

                </ul>
                <div style="text-align: center;">
                    <img src="logo_corporate.png" alt="" style="width: 77%;">
    
                </div>
            </ul>
            <!-- END X-NAVIGATION -->
        </div>

        <!-- END PAGE SIDEBAR -->


        <!-- PAGE CONTENT -->
        <div class="page-content">

            <!-- START X-NAVIGATION VERTICAL -->
            <ul class="x-navigation x-navigation-horizontal x-navigation-panel" style="">
                <li class="xn-icon-button menu_icon_button">
                    <a href="#" class="x-navigation-minimize"><span><i class="fa fa-dedent"></i></span></a>
                </li>
                <li class="page_title_li" style="text-align: center;width: 65%;">
                    <a href="#" class="mb-control pagination-centered"> <span id="page_title" class="mb-control pagination-centered"></span></a>
                </li>
                <li style="text-align: center; padding-right: 10%; ">
                    <select id="languageId">
                        <option selected disabled hidden style='display: none' >Select Language..</option>
                        <option value="<%= LANGUAGES.spanish %>">Español</option>
                        <option value="<%= LANGUAGES.english %>">Inglés</option>
                </select>
                </li>
                <li id="inbox-icon" onclick="show_notification_popup('<%= constant_json.CORPORATE_UNIQUE_NUMBER %>')" style="color: white; top: -11px;">
                            <div class="form-group">                                       
                            <i class="fa fa-envelope " ></i>
                            <span class="notificationBadge"></span>
                        </div>
                        </li>
    
                <li class="xn-icon-button pull-right last">
                    <% if (process.env.INTEGRATION_NEW_TRAVEL === 'true') { %>
                        <a href="<%= process.env.NEW_LOGIN %>" class="logout-button"><span><i class="fa fa-power-off"></i></span></a>
                    <% } else { %>
                        <a href="corporate_sign_out" class="logout-button"><span><i class="fa fa-power-off"></i></span></a>
                    <% } %>
                </li>


            </ul>
            <div id="cover-spin"></div>
            <% include notification_popup.html%>

            <% include whatsapp_contact.html %>
            <% include validation_script.html %>
