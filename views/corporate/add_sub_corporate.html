<% include corporate_header.html %>     
<link href="css/fSelect.css"
rel="stylesheet" type="text/css" />
<script src="js/fSelect.js"
type="text/javascript"></script>               
<!-- PAGE TITLE -->
<style>
    .colorbar{
        margin-left: -11px !important;
    }
</style>
<div class="page-title">                    
    <h2><span class="fa fa-cogs"></span> 
        <% if(data){ %>
            <%= __('title_edit_sub_user') %>
        <% } else { %>
            <%= __('title_add_sub_user') %>
        <% } %>
    </h2>
</div>
<!-- END PAGE TITLE -->    
<div class="alert alert-danger text-center" role="alert" id="promo_error" style="display:none">
    <button type="button" id="close" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
    <p align="center"> <strong  id="message"></strong></p>
</div>
<div class="alert alert-success text-center" role="alert" id="success_message" style="display:none">
    <button type="button" id="close" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
    <p align="center"> <strong  id="message"></strong></p>
</div>

<!-- PAGE CONTENT WRAPPER -->
<div class="page-content-wrap">
    <div class="row">
    <div class="col-md-6 col-sm-8 col-xs-12">

    <!-- for edit corporate page -->
        <% if(data){ %>
			<form class="form-horizontal update_subcorporate_form" method="post" action="/update_subcorporate">
				<div class="panel panel-default">
					<div class="panel-body form-group-separated">  
                    <input type="hidden"  class="form-control" name="user_id" value="<%= corporate_type_userid %>"/> 
					<input type="hidden"  class="form-control" name="id" value="<%= data._id %>"/> 
						<div class="form-group">
							<label class="col-md-3 col-xs-5 control-label"><%= __('title_name') %></label>
							<div class="col-md-9 col-xs-7">
								<input type="text"  class="form-control" name="name" value="<%= data.name %>" />
							</div>
						</div>

                        <div class="form-group" id="url_array_div">
                            <label class="col-md-3 col-xs-5 control-label"><%= __('title_url') %></label>
                            <div class="col-md-9 col-xs-7">
                                <select id="url_array" multiple="multiple" name="url_array[]">
                                    <optgroup id="append" label='Url List'>
                                        <% url_array_list.forEach(function(url){ %>
                                            <% if(data.url_array.indexOf(url.value) !== -1){ %>
                                                <option value="<%= url.value %>" selected><%= url.label %></option>
                                            <% } else { %>
                                                <option value="<%= url.value %>"><%= url.label %></option>
                                            <% } %>
                                        <% }) %>
                                    </optgroup>
                                </select>
                            </div>
                        </div>

						<div class="form-group">
							<label class="col-md-3 col-xs-5 control-label"><%= __('title_email') %></label>
							<div class="col-md-9 col-xs-7">
                                <input type="text" pattern='^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$' class="form-control" name="email" value="<%= data.email %>"/>								
							</div>
						</div>
						<div class="form-group">
                            <label class="col-md-3 col-xs-5 control-label"><%= __('title_phone') %></label>
                            <div class="col-md-9 col-xs-7">
                                <div class="col-md-3">
                                    <input type="text"  class="form-control" value="<%= country_phone_code  %>" readonly/>
                                </div>
                                <div class="col-md-9">
                                  <input type="text" onkeypress="return isNumberKey(event);" id="phone"  class="form-control" value="<%= data.phone %>"  name="phone" minlength="<%= setting_detail.minimum_phone_number_length%>" maxlength="<%= setting_detail.maximum_phone_number_length%>" />
                                </div>
                            </div>
                        </div>
 
						<div class="form-group">
							<label class="col-md-3 col-xs-5 control-label"><%= __('title_password') %></label>
							<div class="col-md-9 col-xs-7">
								<input type="password"  class="form-control" name="password"/>
							</div>
						</div>
						
                        <div class="form-group">
							<label class="col-md-3 control-label"><%= __('title_needs_approve_trip') %></label>
							<div class="col-md-9 ">
							  <label class="switch">
								<% if( data.is_trip_approve == false ) { %>
								<input type="checkbox" class="switch" value="1" name="is_trip_approve" unchecked />
								<% } else{ %>
								<input type="checkbox" class="switch" value="1" name="is_trip_approve" checked />
								<% } %>
								<span></span>
							  </label>
							</div>
						  </div>
                          
                          <div class="form-group">
							<label class="col-md-3 control-label"><%= __('title_is_admin') %></label>
							<div class="col-md-9 ">
							  <label class="switch">
								<% if( data.is_subcorporate_admin == true ) { %>
                                    <input type="checkbox" class="switch" value="1" name="is_subcorporate_admin" checked />
                                <% } else{ %>
                                    <input type="checkbox" class="switch" value="1" name="is_subcorporate_admin" unchecked />
								<% } %>
								<span></span>
							  </label>
							</div>
						  </div>

                          <div class="form-group">
							<label class="col-md-3 control-label"><%= __('title_hide_amount') %></label>
							<div class="col-md-9 ">
							  <label class="switch">
								<% if( data.is_hide_amount == true ) { %>
                                    <input type="checkbox" class="switch" value="1" name="is_hide_amount" checked />
                                <% } else{ %>
                                    <input type="checkbox" class="switch" value="1" name="is_hide_amount" unchecked />
								<% } %>
								<span></span>
							  </label>
							</div>
						  </div>

                          <div class="form-group">
                              <div class="col-md-12 col-xs-12">
                                  <button style="margin-left: 1rem;" class="btn btn-primary btn-rounded pull-right" type="submit" name="update" value="update"> <%= __('button_save') %></button>
                                </form>
                                <form method="post" class="remove_form" action="/corporate_remove_subcorporate_user">
                                    <input type="hidden" name="id" value="<%= data._id %>" />

                                    <button type="submit" class="btn btn-primary btn-rounded pull-right"><%= __('title_remove') %></button>
                                </form>
                                <!-- ///////////////////////// -->
                                <!-- for add corporate page -->
                                <% }else{ %>
                                    <form class="form-horizontal add_subcorporate_form" >
                                        <div class="panel panel-default">
                <div class="panel-body form-group-separated">   
                                        
                    <div class="form-group">
                        <label class="col-md-3 col-xs-5 control-label"><%= __('title_select_user') %></label>
                        <div class="col-md-9 col-xs-7">
                            <select class="form-control select" id="select_user_id" data-none-selected-text="<%= __('title_nothing_selected') %>" name="user_id">
                                <option selected disabled hidden style='display: none'><%= __('title_select_user') %></option>
                                <% users.forEach(function(data) { %>
                                <option value="<%= data._id %>"><%= data.email %></option>
                                <% }); %>
                            </select>
                        </div>
                    </div>


                    <div class="form-group">
                        <label class="col-md-3 col-xs-5 control-label"><%= __('title_name') %></label>
                        <div class="col-md-9 col-xs-7">
                            <input type="text"  class="form-control" name="name"/>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-md-3 col-xs-5 control-label"><%= __('title_email') %></label>
                        <div class="col-md-9 col-xs-7">
                            <input type="text"  class="form-control" name="email"/>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-md-3 col-xs-5 control-label"><%= __('title_password') %></label>
                        <div class="col-md-9 col-xs-7">
                            <input type="password"  class="form-control" name="password"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 col-xs-5 control-label"><%= __('title_phone') %></label>
                        <div class="col-md-9 col-xs-7">
                            <div class="col-md-3">
                                <input type="text"  class="form-control" value="<%= country_phone_code  %>" readonly/>
                            </div>
                            <div class="col-md-9">
                                <input type="text" onkeypress="return isNumberKey(event);" id="phone" minlength="<%= setting_detail.minimum_phone_number_length%>" maxlength="<%= setting_detail.maximum_phone_number_length%>" class="form-control"  name="phone"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="url_array_div" >
                        <label class="col-md-3 col-xs-5 control-label"><%= __('title_url') %></label>
                        <div class="col-md-9 col-xs-7">
                            <select id="url_array" multiple="multiple" name="url_array[]">
                                <optgroup id="append" label='Url List'>
                                    <% url_array_list.forEach(function(url){ %>
                                        <option value="<%= url.value %>"><%= url.label %></option>
                                        <% }) %>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-3 control-label"><%= __('title_needs_approve_trip') %></label>
                        <div class="col-md-9 ">
                          <label class="switch">
                              <input type="checkbox" class="switch" value="0" id="is_trip_approve" name="is_trip_approve" unchecked />
                              <span></span>
                            </label>
                        </div>
                      </div>
                      <div class="form-group">
                          <label class="col-md-3 control-label"><%= __('title_is_admin') %></label>
                          <div class="col-md-9 ">
                              <label class="switch">
                                  <input type="checkbox" class="switch" value="0" id="is_subcorporate_admin" name="is_subcorporate_admin" unchecked />
                                  <span></span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
							<label class="col-md-3 control-label"><%= __('title_hide_amount') %></label>
							<div class="col-md-9 ">
							  <label class="switch">
                                <input type="checkbox" class="switch" value="0" id="is_hide_amount" name="is_hide_amount" unchecked />
								<span></span>
							  </label>
							</div>
						  </div>

                        <div class="form-group">
                        <div class="col-md-12 col-xs-12">
                            <button class="btn btn-primary btn-rounded pull-right" type="submit" name="submit" value="submit"> <%= __('button_submit') %></button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <% } %>
    </div>
    
</div>
<% include colorbar.html %>
</div>
<!-- /////////////////////////////// -->
    <script type="text/javascript">
    $(document).ready(function() {
        $(".add_subcorporate_form").validate({
            ignore:[],
            rules: {
                user_id: "required",
                name: "required",
                password: {
                    required: true,
                    minlength: 6
                },
                email: {
                    required: true,
                    email_regex: /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,
                    minlength: 12,
                    maxlength: 64
                }
            }, submitHandler: function(form) {

                document.getElementById("cover-spin").style.display = "block";
                $.ajax({
                    type: 'POST',
                    url: '/add_subcorporate_detail',
                    data: $('.add_subcorporate_form').serialize(),
                    dataType: "json",
                    success: (res) => {
                        if (res.success) {
                            document.getElementById("cover-spin").style.display = "none";
                            document.getElementById('success_message').innerHTML = res.message ;
                            $('#success_message').show();
                            setTimeout(function () {
                                $('#success_message').hide();
                                window.location.href="/corporate_users";
                            }, 1000);
                        }else{
                            document.getElementById("cover-spin").style.display = "none";
                            document.getElementById('promo_error').innerHTML = res.message ;
                            $('#promo_error').show();
                            setTimeout(function () {
                                $('#promo_error').hide();
                            }, 3000);
                        }
                    }
                });
            }
        });


    $(".update_subcorporate_form").validate({
        ignore: [],
        rules: {
            name: "required",
            password: {
                minlength: 6
            },
            email: {
                required: true,
                email_regex: /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,
                minlength: 12,
                maxlength: 64
            }
        }
    });


    $('#url_array').fSelect({
        placeholder: 'Select Url',
        numDisplayed: 3,
        overflowText: '{n} selected',
        searchText: 'Search',
        showSearch: true
    });
});

</script>       
<% include footer_form.html %>
