<% include partner_header.html %>
<%
function breakEveryN(str, limit = 10) {
  const words = str.split(' ');
  const lines = [];
  let currentLine = '';

  for (let word of words) {
    if ((currentLine + ' ' + word).trim().length <= limit) {
      currentLine += (currentLine ? ' ' : '') + word;
    } else {
      if (currentLine) lines.push(currentLine);
      currentLine = word; 
    }
  }

  if (currentLine) lines.push(currentLine);
  return lines.join('<br>');
}
%>


<link href="css/fSelect.css"
rel="stylesheet" type="text/css" />
<script src="js/fSelect.js"
type="text/javascript"></script>    

<style>
  
  .light_font{
    font-weight: 600;
  }

  .p_style{
    font-size: 15px;
    text-align: center;
  }

  .h_style{
    color: rgb(63 186 228);
    text-align: center;
  }

  .h_style b{
    font-weight: 700;
    font-size: 20px;
  }

  .sub_h_style{
    font-weight: 600 !important;
    text-align: center;
    font-size: 16px;
    color: rgb(0 191 179);
    margin: 8px 0px 4px 0px;
  }
  .table-responsive {
  max-width: 100vw;
  overflow-x: auto; /* for horizontal scroll */
  /* height: 400px; */
  overflow-y: scroll; /* for vertical scroll */
  position: relative; /* relative to the normal flow */
  border: solid 5px red; /* for reference */
}

/* Custom scrollbar styles */
.table-responsive::-webkit-scrollbar {
  height: 10px; /* Adjust as needed */
  width: 10px; /* Adjust as needed */
  background-color: #f5f5f5; /* Change the background color */
}

.table-responsive::-webkit-scrollbar-thumb {
  background-color: #c7c7c7; /* Change the thumb color */
  border-radius: 6px; /* Round the corners of the thumb */
}

.table-responsive::-webkit-scrollbar-thumb:hover {
  background-color: #999; /* Change the thumb color on hover */
}

.table-responsive::-webkit-scrollbar-track {
  background-color: #f5f5f5; /* Change the track color */
}

.unassigned_trip_colour {
  background-color: rgba(255, 0, 0, 0.288) !important;
}

/* User details modal css start */
.static-text {
  font-weight: bold;
  font-size: 16px;
  color: rgb(37, 14, 98);
}
.modal-title {
  font-size: 21px;
  font-weight: 700;
  color: rgb(37, 14, 98);
  text-align: center;
  margin: 1rem 0rem;
}

.dynamic-text {
  color: #000000;
  font-size: 16px;
}

.modal-header {
  background-color: #f8f9fa;
  border-bottom: none;
  border-radius: 12px;
}

#userDetailsModal .modal-header .close {
  margin-bottom: 10px;
  margin-top: 13px;
  margin-right: 17px;
}


.modal-body {
  padding: 20px;
}

.modal-footer {
  background-color: #f8f9fa;
  border-top: none;
  text-align: center;
  border-radius: 12px;
}
.modal-footer .btn, .modal-footer .btn:hover {
  background: rgb(37, 14, 98);
  color: #f8f9fa;
  border-radius: 16px
}

.btn-close {
  color: #000;
  opacity: 0.7;
}

.btn-close:hover {
  color: #000;
  opacity: 1;
}

.btn-secondary {
  background-color: #6c757d;
  color: #fff;
  border: none;
}

.btn-secondary:hover {
  background-color: #5a6268;
}

.fs-label-wrap{
  border-radius: 5px;
  color: rgb(62 62 62);
  padding-left: 7px;
}

.fs-arrow{
  border-left: 4px solid rgb(0 0 0 / 0%);
  border-right: 4px solid rgb(0 0 0 / 0%);
  border-top: 4px solid rgb(51 51 51);
  right: 11px;
}

.card-body {
  position: relative;
  text-align: center;
}

.card-title {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: rgb(37, 14, 98);
}

.modal-content{
  border-radius: 12px;
  border-width: 1px;
}

/* User details modal css end */
.image-container {
  position: relative;
}

.download-wrapper {
  position: absolute;
  top: 10px;
  right: 30px;
  z-index: 1;
  background-color: rgb(211 200 224);
  padding: 10px;
  border-radius: 50%;

}

.btn-download {
  background-color: rgb(0, 191, 179);
  color: #fff;
  border-radius: 50px;
  padding: 12px 28px;
  font-size: 16px;
  text-transform: uppercase;
  font-weight: 500;
  transition: all 0.2s ease;
  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
  border: none;
  outline: none;
}

.card-title {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: rgb(37, 14, 98);
}

.icon_class {
    font-size: 37px;
    color:  rgb(37 14 98);
}

.modal-title {
  font-size: 21px;
  font-weight: 700;
  color: rgb(37, 14, 98);
  text-align: center;
  margin: 1rem 0;
}

.card-img-top {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain; 
  display: flex;
  margin: auto;
}

.card-body {
  position: relative;
  padding: 1rem;
  text-align: center;
}

.card-body .btn-primary {
  font-weight: 500;
  font-size: 14px;
  text-transform: uppercase;
  padding: 8px 20px;
  transition: all 0.2s;
}

#show_trip_doc_modal .modal-body {
  max-height: 70vh; 
  overflow-y: auto;
}

.pdf-uploaded {
  display: inline-block;
  background-color: rgb(242 242 242);
  border-radius: 5px;
  padding: 23px 46px;
  color: rgb(51 51 51);
  font-size: 23px;
  font-weight: bold;
  line-height: 1.5;
}

.pdf-uploaded-icon {
  display: inline-block;
  width: 20px;
  height: 20px;
  margin-right: 5px;
  text-align: center;
  color: #4CAF50;
}

.pdf-uploaded-text {
  display: inline-block;
  vertical-align: middle;
  text-align: center;
}

th{
  z-index: 1;
  vertical-align: middle !important;
}

.vertical-timeline {
  position: relative;
  margin-left: 10px;
  padding-left: 20px;
  border-left: 2px solid #2c2c72;
  width: 150px;
  height: auto;
}

.status-label {
  padding-bottom: 6px;
  font-size: 13px;
  line-height: 1;
  max-width: 140px;
  word-wrap: break-word;
  white-space: normal;
  transform: translateY(0);
  color: gray;
}

.label-completed {
  color: #2c2c72;
}

.label-active {
  color: #00BBB4;
  font-weight: bold;
}

.label-upcoming {
  color: #656C78;
}

.label-cancelled {
  color: red;
  font-weight: bold;
  top: 10px !important;
}

.dot.cancelled-dot-top,
.dot.cancelled-dot-bottom {
  background-color: red;
}

.dot {
  position: absolute;
  left: -6px;
  width: 10px;
  height: 10px;
  background-color: #2c2c72;
  border-radius: 50%;
}

.dot-highlight {
  left: -26px;
  background-color: #00BBB4;
}
.dot.top {
  top: 0;
}

.dot.bottom {
  bottom: 0;
}

.label-highlight {
  color: #00BBB4;
}
.label {
  display: inline;
  padding: 0.4em .6em .4em;
  font-size: 88%;
}


.trip-action {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  padding-top: 4px;
  border-radius: 6px;
  margin-bottom: 6px;
  transition: background 0.2s;
}

.trip-action i {
  font-size: 20px;
}

.trip-action span {
  font-size: 12px;
  color: #656C78;
}
/* Media queries for responsive height */
@media (min-width: 768px) {
  /* Adjust the height for larger screens */
  .table-responsive {
    height: 450px;
  }
}

@media (min-width: 1360px) {
  /* Adjust the height for even larger screens */
  .table-responsive {
    height: 550px;
  }
}

@media (min-width: 1840px) {
  /* Adjust the height for even larger screens */
  .table-responsive {
    height: 830px;
  }
}

table > tbody > tr.selectedRow:hover {
  background: #e6f9f7;
}

table > tbody > tr.selectedRow > td {
  background: transparent
}
</style>

                <!-- PAGE CONTENT WRAPPER -->
                <div class="page-content-wrap">
    <% if(typeof message != 'undefined'){ %>
       <div class="alert alert-success" role="alert">
          <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
          <p align="center"> <strong><%= __(message) %></strong></p>
      </div>
      <% } %>  
      <div class="alert alert-success" role="alert" id="request_error" style="display:none">
        <button type="button" id="close" class="close"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
        <p align="center" id="request_message"> <strong></strong></p>
      </div>
     
                <!-- START TIMELINE FILTER --> 
      <!-- END TIMELINE FILTER -->                
                
                    <div class="row">
                        <div class="col-md-12">

                            <!-- START SIMPLE DATATABLE -->
                            <div class="panel panel-default">                                
                                <div class="table-responsive" style="padding-bottom: 175px;">
                                        <table class="table text-center" id="customers2">
                                            <thead>
                                                <tr>                                                 
                                                  <th><%- breakEveryN(__('title_id')) %></th>
                                                  <th><%- breakEveryN(__('title_created_date')) %></th>
                                                  <th><%- breakEveryN(__('title_loading_date')) %></th>
                                                  <th style="width: 10%;"><%- breakEveryN(__('title_user')) %></th>
                                                  <th><%- breakEveryN(__('title_assigned_unit')) %></th>
                                                  <th style="width: 15%;"><%- breakEveryN(__('title_route')) %></th>
                                                  <th style="width: 10%;"><%- breakEveryN(__('title_shipping_details')) %></th>
                                                  <th style="width: 13%;"><%- breakEveryN(__('title_status')) %></th>
                                                  <th><%- breakEveryN(__('title_payment_details')) %></th>
                                                  <th style="width: 10%;"><%= __('button_action') %></th>
                                                </tr>
                                            </thead>
                                            
                                            <tbody>
                                              <% detail.forEach(function(data){ %>
                                                <tr class="selectedRow <%= data.unassigned === 1 ? 'unassigned_trip_colour' : '' %>">
                                                  <td><%= data.unique_id %></td>
                                                  <td><%= moment(data.created_at).tz(timezone_for_display_date).format("DD MMM 'YY") %></br><%= moment(data.created_at).tz(timezone_for_display_date).format("hh:mm a") %></td>
                                                  <td><%= moment(data.server_start_time_for_schedule || data.created_at).tz(timezone_for_display_date).format("DD MMM 'YY") %>
                                                  </br><%= moment(data.server_start_time_for_schedule || data.created_at).tz(timezone_for_display_date).format("hh:mm a") %></td>
                                                  <td><%= data.user_detail.first_name %> <%= data.user_detail.last_name %></td>
                                                  <td>
                                                    <%= data?.type_detail?.typename %>
                                                  <br><%= data?.model_details?.model_name %>
                                                  <br>
                                                  <span style="color: #25215F"><%= __('title_provider') %>:</span>
                                                  <% if (data.provider_detail.length > 0) { %>
                                                    <%= data.provider_detail[0].first_name %> <%= data.provider_detail[0].last_name %>
                                                  <% } %>
                                                  <br>
                                                  <span style="color: #25215F"><%= __('title_plate_no') %>:</span>
                                                  <% if (data?.assigned_vehicle_details?.vehicle_plate_no) { %>
                                                    <%= data.assigned_vehicle_details.vehicle_plate_no %>
                                                  <% } %>
                                                  <br> <span style="color: #25215F"><%= __('title_helpers') %>:</span>  <%= data?.pickup_details[0]?.user_details?.no_of_helpers %></td>
                                                  
                                                  <td><span style="color: #25215F"><%= __('title_origin') %>:</span> <%= data.source_address %> 
                                                  <br> <span style="color: #25215F"><%= __('title_destination') %>:</span> <%=  data.initial_destination_address ?  data.initial_destination_address : data.destination_address%> %>
                                                  <br> <span style="color: #25215F"><%= __('title_cities') %>:</span> <%= data?.destination_addresses?.length %>
                                                  <br>   
                                                    <a href="#" id="see_trip_info_modal_btn<%=data._id%>" style="display:block; color: #00BBB4;">
                                                      <%= __('button_shipping_details') %>
                                                    </a>
                                                  </form></td>
                                                  <td>
                                                  <span style="color: #25215F"><%= __('title_cities') %>:</span><%= data?.destination_addresses?.length %> 
                                                  <br> <span style="color: #25215F"><%= __('unit_km') %>:</span> <%=  data?.estimated_distance %>
                                                  <br> <span style="color: #25215F"><%= __('title_night_shifts') %>:</span> <%= data?.night_shift %>
                                                  <br> <span style="color: #25215F"><%= __('title_ferry_ticket') %>:</span><% if(data.boat_ticket > 0) { %> <%= __('title_yes') %>
                                                        <% } else { %>  <%= __('title_no')%> <%}%>
                                                  <br><form id="mapForm_<%= data._id %>" method="post" action="/partner_trip_map">
                                                    <input type="hidden" name="id" value="<%= data._id %>" />
                                                    <input type="hidden" name="u_name" value="<%= data.user_detail.first_name %> <%= data.user_detail.last_name %>" />
                                                    <% if (data.provider_detail.length > 0) { %>
                                                      <input type="hidden" id="pr_name<%= data._id %>" name="pr_name" value="<%= data.provider_detail[0].first_name %> <%= data.provider_detail[0].last_name %>" />
                                                    <% } %>
                                                    <a href="#" onclick="document.getElementById('mapForm_<%= data._id %>').submit(); return false;" style="display:block; color: #00BBB4;">
                                                      <%= __('button_view_map') %>
                                                    </a>
                                                  </form>
                                                  </td>
                                                  <% const providerSteps = [
                                                    { key: 'waiting', label: __('title_trip_status_waiting') },
                                                    { key: 'accepted_request', label: __('title_accepted_request') },
                                                    { key: 'waiting_to_start', label: __('title_trip_status_waiting_to_start_journey') },
                                                    { key: 2, label: __('title_trip_status_coming') },
                                                    { key: 4, label: __('title_trip_status_arrived') },
                                                    { key: 6, label: __('title_trip_status_trip_started') },
                                                    { key: 7, label: __('title_trip_status_arrived_at_destination') },
                                                    { key: 9, label: __('title_trip_status_completed') }
                                                  ];

                                                  if (data?.model_type === MODEL_TRUCK_TYPE.CABEZAL) {
                                                    providerSteps.splice(3, 0,
                                                      { key: 'waiting_unloading', label: __('title_trip_status_waiting_for_unloading') },
                                                      { key: 'waiting_driver', label: __('title_trip_status_waiting_for_driver_assignment') },
                                                      { key: 'pending_pickup', label: __('title_trip_status_pending_pickup') },
                                                      { key: 'returning_pickup', label: __('title_trip_status_returning_pickup') }
                                                    );
                                                  }

                                                  let activeKey = null;
                                                  if (data?.drop_trip_status == 1 && !data.assigned_provider_id && !data.unload_notification_sent) {
                                                    activeKey = 'waiting_unloading';
                                                  } else if (data?.drop_trip_status == 1 && !data.assigned_provider_id && data.unload_notification_sent) {
                                                    activeKey = 'waiting_driver';
                                                  } else if (data?.drop_trip_status == 1 && data.assigned_provider_id) {
                                                    activeKey = 'pending_pickup';
                                                  } else if (data?.drop_trip_status <= 2 && data.assigned_provider_id && data.is_provider_status != 9) {
                                                    activeKey = 'returning_pickup';
                                                  } else if (data.is_provider_status == 1 || data.is_provider_status == 0) {
                                                    if (data.is_provider_accepted == 1) {
                                                      activeKey = 'waiting_to_start';
                                                    } else {
                                                      activeKey = data.assigned_provider_id ? 'accepted_request' : 'waiting';
                                                    }
                                                  } else {
                                                    activeKey = data.is_provider_status;
                                                  }

                                                  const activeIndex = providerSteps.findIndex(step => step.key === activeKey);
                                                  %>

                                                  <td>
                                                    <% if (data?.is_trip_cancelled == 1) { %>
                                                      <div class="vertical-timeline" style="min-height: 40px; border-left: 2px solid red;">
                                                        <div class="dot cancelled-dot-top" style="top: 0;"></div>
                                                        <div class="status-label label-cancelled" style="top: 0;"><%= __('title_cancelled') %></div>
                                                        <div class="dot cancelled-dot-bottom" style="bottom: 0;"></div>
                                                      </div>
                                                      <% } else { %>
                                                        <div class="vertical-timeline" >
                                                      <div class="dot top"></div>
                                                      <% providerSteps.forEach((step, index) => {
                                                        let className = index < activeIndex ? 'label-highlight' : (index === activeIndex ? 'label-active' : 'label-upcoming');
                                                        let statusDotClass = index === activeIndex && activeIndex > 0 && activeIndex < providerSteps.length - 1 ? 'dot dot-highlight' : "";

                                                      %>
                                                        <div class="status-label <%= className %>" style="top: calc(<%= index %> * 30px)"><div class="<%= statusDotClass %>"> </div> <%= step.label %></div>
                                                      <% }); %>                    
                                                      <div class="dot bottom"></div>
                                                    </div>
                                                    <% } %>
                                                  </td>

                                                  <td>
                                                    $<%= (data.provider_service_fees).toFixed(2) %>
                                                  </td>

                                                  <td>
                                                    <div class="trip-action" onclick="document.getElementById('see_trip_info_modal_btn<%=data._id%>').click()">
                                                      <img src="/FLETY_DETALLESDEVIAJE.svg" alt="map icon" style="width: 20px; height: 20px; transform: scale(0.9);" />
                                                      <span><%= __('button_shipping_details') %></span>
                                                    </div>

                                                      <% if(!data.provider_type_id) { %>
                                                      <div class="trip-action" onclick="assign_vehicle_driver('<%=data._id%>')">
                                                        <img src="/fi-ts-car-alt.svg" alt="map icon" style="width: 20px; height: 20px; transform: scale(0.9);" />
                                                        <span><%= __('button_book_request') %></span>
                                                      </div>  
                                                      <% } else if(data?.provider_type_id?.toString() == id?.toString() && data?.assigned_provider_id && data.is_provider_status < 6 && data.is_trip_cancelled == 0){ %>
                                                      <div class="trip-action" onclick="get_available_drivers_vehicles('<%=data._id%>','provider')">
                                                        <img src="/fi-ts-undo.svg" alt="map icon" style="width: 20px; height: 20px; transform: scale(0.9);" />
                                                        <span><%= __('button_change_driver') %></span>
                                                      </div>  

                                                      <div class="trip-action" onclick="get_available_drivers_vehicles('<%=data._id%>','vehicle')">
                                                        <img src="/fi-ts-undo.svg" alt="map icon" style="width: 20px; height: 20px; transform: scale(0.9);" />
                                                        <span><%= __('button_change_vehicle') %></span>
                                                      </div>  

                                                      <div class="trip-action" onclick="unassign_trip('<%=data._id%>')">
                                                        <img src="/fi-ts-truck-arrow-right.svg" alt="map icon" style="width: 20px; height: 20px; transform: scale(0.9);" />
                                                        <span><%= __('button_unassign_request') %></span>
                                                      </div>  
                                                      <% } %>
                                                      <% if (data.corporate_doc && data.corporate_doc.length > 0) { %>
                                                        <div class="trip-action" id="show_trip_docs<%= data._id %>">
                                                          <i class="fa fa-sticky-note text-primary"></i>
                                                          <span><%= __('button_show_trip_document') %></span>
                                                        </div>  
                                                      <% } %>  
                                                  </td>
                                                </tr>

                                              <div class="modal fade" id="userDetailsModal<%= data.user_detail._id %>" tabindex="-1" aria-labelledby="userDetailsModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered modal-oval">
                                                  <div class="modal-content">
                                                    <div class="modal-header">
                                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                      </button>
                                                      <h5 class="modal-title" id="userDetailsModalLabel"><%= __('title_user_details') %></h5>
                                                    </div>
                                                    <div class="modal-body">
                                                      <p><span class="static-text"><%= __('title_branch') %>:</span><span class="dynamic-text"> <%= data.user_detail.company_details ? data.user_detail.company_details.branch : "" %></span></p>
                                                      <p><span class="static-text"><%= __('title_city') %>:</span><span class="dynamic-text"> <%= data.user_detail.city %></span></p>
                                                      <p><span class="static-text"><%= __('title_notes') %>:</span><span class="dynamic-text"> <%= data.user_detail.company_details ? data.user_detail.company_details.notes : "" %></span></p>
                                                      <div id="corporate_details<%= data.user_detail._id %>"></div> 
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>      

                                              <div class="modal fade " id="show_helper_modal<%=data._id%>" tabindex="-1" role="dialog" aria-labelledby="show_helper_modal_label" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered" >
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
                                                            <h4 class="modal-title" id="show_helper_modal_label" style="color: rgb(37 14 98); text-align: center;"><%= __('title_helper_details') %></h4>
                                                        </div>
                                                          <div class="modal-body" style="text-align: center;">
                                                            <% data.helper_details.forEach(function(data, index){ %>
                                                              <div class="row"><div class="col-md-12"><div class="card mb-3">
                                                              <div class="card-body"><h5 class="card-title"><%= __('title_helper') %> <%= index + 1 %></h5></div></div></div></div>
                                                              <p><span class="static-text"><%= __('title_name') %>: </span><span class="dynamic-text"> <%= data.name %> </span></p>
                                                          <% }); %>
                                                          </div>
                                                    </div>
                                                </div>
                                              </div>

                                              <div class="modal animated fadeIn" data-backdrop="static" data-keyboard="false" id="trip_details_modal<%=data._id%>" tabindex="-1" role="dialog" aria-labelledby="trip_details_modal<%=data._id%>" aria-hidden="true">
                                                <div class="modal-dialog modal-lg">
                                                  <div class="modal-content">
                                                    <div class="modal-header">
                                                      <button type="button" id="trip_details_modal_close" class="close modal_close<%=data._id%>" data-dismiss="modal" ><span aria-hidden="true">&times;</span><span class="sr-only"><%= config_json.button_close %></span></button>
                                                      <h3 class="h_style"><b><%= __("title_trip_fare_details") %></b></h3>                                                      
                                                    </div>
                                                    <div class="modal-body">
                                                      <h3 class="sub_h_style"><b><%= __('title_pickup_address') %></b></h3>                                                    
                                                      <p class="p_style" ><b><%= __("title_origin") %></b>: <span id="trip_origin<%=data._id%>"></span></p>
                                                      <div id="stop_details_data<%=data._id%>" style="display: none;">
                                                      </div>              
                                                      <h3 class="sub_h_style"><b><%= __('title_destination_address') %></b></h3>                                                    
                                                      <p class="p_style"><b><%= __("title_destination") %></b>: <span id="trip_destination<%=data._id%>"></span></p>
                                                      
                                                      <h3 class="sub_h_style"><b><%= __('travel_info_modal') %></b></h3>                                                    
                                                      <p class="p_style"><b><%= __("title_loading_date") %></b>: <span id="trip_start_date<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_loading_time") %></b>: <span id="trip_start_time<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_weight_of_load') %></b>: <span id="trip_weight_load<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_volume_of_load') %></b>: <span id="trip_volume_load<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_type_of_services") %></b>: <span id="trip_selected_service<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_truck_model") %></b>: <span id="trip_selected_type<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_capacity") %></b>: <span id="trip_selected_capacity<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_count_night_shift") %></b>: <span id="count_night_shift<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_ferry_ticket") %></b>: <span id="ferry_ticket<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_truck_type") %></b>: <span id="trip_vehicle_model<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("flety_pay") %></b>: <span id="trip_total<%=data._id%>"></span></p>
                                      
                                                      <p class="p_style"><b><%= __('title_weight_of_load') %></b>: <span id="pickup_weight_of_load<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_number_of_helpers_for_load") %></b>: <span id="helpers_load<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __("title_number_of_helpers_for_download") %></b>: <span id="helpers_download<%=data._id%>"></span></p>
                                                      <p class="p_style trip_type_procedure<%=data._id%>"><b><%= __("title_select_type_of_procedure") %></b>: <span id="trip_type_procedure<%=data._id%>"></span></p>
                                                      <p class="p_style trip_transit_service_type<%=data._id%>"><b><%= __("title_need_internal_transit_service") %></b>: <span id="trip_transit_service_type<%=data._id%>"></span></p>
                                                      <p class="p_style trip_transit_number<%=data._id%>"><b><%= __("title_number_of_services_for_you") %></b>: <span id="trip_transit_number<%=data._id%>"></span></p>

                                                      <h3 class="sub_h_style"><b><%= __("title_pickup_details") %></b></h3>                                                      
                                                      <p class="p_style"><b><%= __('title_company_name') %></b>: <span id="pickup_company_name<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_name') %></b>: <span id="pickup_name<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_phone') %></b>: <span id="pickup_phone<%=data._id%>"></span></p>
                                      
                                                      <p class="p_style"><b><%= __('title_description') %></b>: <span id="pickup_description<%=data._id%>"></span></p>
                                                      <h3 class="sub_h_style"><b><%= __('title_delivery_details') %></b></h3>                                                    
                                                      <p class="p_style"><b><%= __('title_company_name') %></b>: <span id="delivery_company_name<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_name_of_delivery_receiver') %></b>: <span id="delivery_name<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_phone') %></b>: <span id="delivery_phone<%=data._id%>"></span></p>
                                                      <p class="p_style"><b><%= __('title_description') %></b>: <span id="delivery_description<%=data._id%>"></span></p>
                                                      <div id="trip_load_images<%=data._id%>" style="display: none;">
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                      
                                              <% }); %>
                                          </tbody>
                                        </table>
                                    </div>
                            </div>
                            <!-- END SIMPLE DATATABLE -->

                        </div>
                    </div>                                
                    <% include colorbar.html %>
                    <% include web_advertise.html %>

                </div>
                <!-- PAGE CONTENT WRAPPER -->                                
            </div>    
            <!-- END PAGE CONTENT -->
        </div>
        <!-- END PAGE CONTAINER -->  



        <div class="modal animated fadeIn" id="assign_driver_vehicle_modal" tabindex="-1" role="dialog" aria-labelledby="smallModalHead" aria-hidden="true">
          <div class="modal-dialog" style="width: 50%; min-width: 300px;">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
                      <h4 class="modal-title" style="font-size: 17px;"><%= __('title_assign_vehicle_driver') %></h4>
                  </div>
                  <form class="form-horizontal" id="assign_driver_vehicle_form">
                      <div class="modal-body">
                        <div class="form-group col-md-12">
                          <select id="available_vehicles" data-live-search="true" name="selected_vehicle_id" class="form-control select">
                            <option style="display: none" selected><%= __('title_select_vehicle') %></option>
                          </select>
                        </div>

                        <div class="form-group col-md-12 vehicle_selection_2">
                          <select id="available_vehicles_2" data-live-search="true" name="selected_vehicle_id_2" class="form-control select">
                            <option style="display: none" selected><%= __('title_select_vehicle_2') %></option>
                          </select>
                        </div>
                        <p align="center" style="color: red;" > <strong id="message1"  style="display:none"><%= __('same_vehicle_error') %></strong></p>

                        <div class="form-group col-md-12">
                          <input type="hidden" id="selected_driver_name"  />
                          <input type="hidden" id="selected_driver_phone"  />
                          <input type="hidden" id="selected_vehicle_id"  />

                          <select id="available_drivers" data-live-search="true" name="selected_driver_id" class="form-control select">
                            <option style="display: none" selected><%= __('title_select_driver') %></option>
                          </select>
                        </div>
                        <div id="helpers_list_div" class="form-group col-md-12">
                          <select id="helpers_list" multiple="multiple" name="helpers_list[]">
                            <optgroup id="append" label='<%= __('title_select_helpers') %>'>
                              <% helpers_list.forEach(function(helper){ %>
                                  <option value="<%= helper._id %>"><%= helper.name %></option>
                                <% }) %>
                            </optgroup>
                        </select>
                        </div>

                      </div>
                      <div class="modal-footer">
                          <input type="button" id="show_trip_book_details_btn" class="btn btn-primary" name="button" value="<%= __('button_confirm') %>">
                      </div>
                  </form>
                </div>
              </div>
            </div>

        <div class="modal animated fadeIn" data-backdrop="static" data-keyboard="false" id="book_trip_details_modal" tabindex="-1" role="dialog" aria-labelledby="book_trip_details_modal" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" id="book_trip_details_modal_close" class="close modal_close" data-dismiss="modal" ><span aria-hidden="true">&times;</span><span class="sr-only"><%= config_json.button_close %></span></button>
                <label></label>
              </div>
              <div class="modal-body">
                <h4 class="h_style"><b><%= __("title_trip_fare_details") %></b></h4>
                <p class="p_style" ><b><%= __("title_origin") %></b>: <span id="trip_origin"></span></p>
                <p class="p_style"><b><%= __("title_destination") %></b>: <span id="trip_destination"></span></p>
                <p class="p_style"><b><%= __("title_loading_date") %></b>: <span id="trip_start_date"></span></p>
                <p class="p_style"><b><%= __("title_loading_time") %></b>: <span id="trip_start_time"></span></p>
                <p class="p_style"><b><%= __("title_type_of_services") %></b>: <span id="trip_selected_service"></span></p>
                <p class="p_style"><b><%= __("title_truck_model") %></b>: <span id="trip_selected_type"></span></p>
                <p class="p_style"><b><%= __("title_capacity") %></b>: <span id="trip_selected_capacity"></span></p>
                <p class="p_style"><b><%= __("title_number_of_helpers_for_load") %></b>: <span id="helpers_load"></span></p>
                <p class="p_style"><b><%= __("title_number_of_helpers_for_download") %></b>: <span id="helpers_download"></span></p>

                <p class="p_style"> <b><%= __("button_detail") %></b>: <span id="trip_detail"></span></p>
                <br>
                <h4 class="h_style"><b><%= __("truck_assigned") %></b></h4>
                <p class="p_style"> <b><%= __("title_model") %></b>: <span id="trip_vehicle_type"></span></p>
                <p class="p_style"> <b><%= __("title_type_of_truck") %></b>: <span id="trip_vehicle_model"></span></p>
                <p class="p_style"> <b><%= __("title_plate_no") %></b>: <span id="trip_vehicle_plateno"></span></p>
                <div class="vehicle_2_details">
                  <p class="p_style"> <b><%= __("title_batea") %></b></p>
                  <p class="p_style"> <b><%= __("title_model") %></b>: <span id="trip_vehicle_type_2"></span></p>
                  <p class="p_style"> <b><%= __("title_type_of_truck") %></b>: <span id="trip_vehicle_model_2"></span></p>
                  <p class="p_style"> <b><%= __("title_plate_no") %></b>: <span id="trip_vehicle_plateno_2"></span></p>
                </div>
                <br>
                <h4 class="h_style"><b><%= __("title_driver_assigned") %></b></h4>
                <p class="p_style"> <b><%= __("email_title_name") %></b>: <span id="trip_assigned_driver"></span></p>
                <p class="p_style"> <b><%= __("email_title_phone") %></b>: <span id="trip_driver_phone"></span></p>
                <p class="p_style"> <b><%= __("title_number_dni") %></b>: <span id="trip_driver_uniqueid"></span></p>
                <p class="p_style"> <b><%= __("flety_pay") %></b>: <span id="trip_total"></span></p>
                
                <form id="partner_book_trip_request_form" class= "form-horizontal" method="post" action="/partner_book_trip_request_btn">
                  <input type="hidden"  name="confirm_provider_id" id="confirm_provider_id" />
                  <input type="hidden"  name="confirm_trip_id" id="confirm_trip_id" />
                  <input type="hidden"  name="confirm_vehicle_id" id="confirm_vehicle_id" />
                  <input type="hidden"  name="confirm_vehicle_id_2" id="confirm_vehicle_id_2" />
                  <input type="hidden"  name="confirm_helpers[]" id="confirm_helpers" />

              </div>
              <div class="modal-footer" style="text-align: center;">
                <input type="submit" id="check_pay_btn" class="btn btn-primary"  value="<%= __('button_book') %>">
              </div>
            </form>
            </div>
          </div>
        </div>

        <div class="modal fade" id="unassignReasonModal" tabindex="-1" role="dialog" aria-labelledby="unassignReasonModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <form id="unassignReasonForm" enctype="multipart/form-data" method="post">
        
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h4 class="modal-title" id="unassignReasonModalLabel"><%= __('title_unassign_trip') %></h4>
                </div>
                
                <div class="modal-body">
                  <div class="form-group" style="font-size: 17px; text-align: center;">
                    <label class="control-label"><%= __('title_unassign_reason') %>:</label>
                    <div>
                      <label>
                        <input type="radio" name="unassign_reason" value="<%= __('title_unassign_reason_1') %>" required> <%= __('title_unassign_reason_1') %>
                      </label><br>
                      <label>
                        <input type="radio" name="unassign_reason" value="<%= __('title_unassign_reason_2') %>" required> <%= __('title_unassign_reason_2') %>
                      </label><br>
                      <label>
                        <input type="radio" name="unassign_reason" value="Other" id="other_reason_radio" required> <%= __('other') %>
                      </label>
                    </div>
                  </div>
                  
                  <!-- Textarea for "Other" reason (Hidden by Default) -->
                  <div class="form-group" id="other_reason_container" style="display: none;">
                    <label class="control-label">Other Reason:</label>
                    <textarea class="form-control" name="unassign_reason_other" id="unassign_reason_other" cols="50" rows="4"></textarea>
                  </div>
        
                  <input type="hidden" name="trip_id" id="unassign_trip_id" />
                </div>
                
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary" id="submitReason"><%= __('button_submit') %></button>
                </div>
        
              </form>
            </div>
          </div>
        </div>
                
        <div class="modal fade " id="show_trip_doc_modal" tabindex="-1" role="dialog" aria-labelledby="smallModalHead" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-lg" >
              <div class="modal-content modal-lg">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
                      <h4 class="modal-title" style="color: rgb(37 14 98); text-align: center;"><%= __('title_trip_documents') %></h4>
                  </div>
                    <div class="modal-body">
                        <div class="trip_docs">
                          
                        </div>
                      </div>
              </div>
          </div>
        </div>
        <div class="modal animated fadeIn" id="change_driver_vehicle_modal" tabindex="-1" role="dialog" aria-labelledby="smallModalHead" aria-hidden="true">
          <div class="modal-dialog" style="width: 40%; min-width: 300px;">
            <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only"><%= __('button_close') %></span></button>
                  <h4 class="modal-title" style="font-size: 17px;"><%= __('title_change_driver') %></h4>
              </div>
              <form class="form-horizontal" id="change_driver_form" method="post">
                <div class="modal-body">
                  <input type="hidden" id="change_driver_trip_id" name="change_driver_trip_id" >
                  <input type="hidden" id="change_type" name="change_type" >
                  <div class="form-group col-md-12 change_vehicle_list">
                    <select id="change_vehicle_list" data-live-search="true" name="change_vehicle_id" class="form-control select">
                      <option style="display: none" selected><%= __('title_select_vehicle') %></option>
                    </select>
                  </div>
  
                  <div class="form-group col-md-12 change_vehicle_selection_2">
                    <select id="change_vehicle_list_2" data-live-search="true" name="change_vehicle_id_2" class="form-control select">
                      <option style="display: none" selected><%= __('title_select_vehicle_2') %></option>
                    </select>
                  </div>
                  <p align="center" style="color: red;" > <strong id="message1"  style="display:none"><%= __('same_vehicle_error') %></strong></p>
                  <div class="form-group col-md-12 change_drivers_list">
                    <select id="change_drivers_list" data-live-search="true" name="change_driver_id" class="form-control select">
                      <option style="display: none" selected><%= __('title_select_driver') %></option>
                    </select>
                </div>
                  <div class="form-group">
                    <label class="col-md-3 col-xs-5 control-label" style="text-align: left;"><%= __('title_change_reason') %>:</label>
                      <div class="col-md-9 col-xs-7">
                          <textarea class="form-control" name="change_driver_reason" id="change_driver_reason" cols="50" rows="4" required></textarea>
                      </div>
                    </div>                                             
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-primary" name="button" value="<%= __('button_confirm') %>">
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <script src="socket.io/socket.io.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.17/moment-timezone-with-data.js"></script>

        <script>
          

        </script>

  <script type="text/javascript">
        $('#helpers_list').fSelect({
        placeholder: '<%= __("title_select_helpers")%>',
        numDisplayed: 3,
        overflowText: '{n} selected',
        searchText: '<%= __("title_search_text")%>',
        showSearch: true
    });

      var trip_details
      var city_type
      var available_vehicles = []
      var available_drivers = []
      var timezone_for_display_date
      let countries = <%-JSON.stringify(countries)%>

      // var moment
  $(document).ready(function() {
    setTimeout(()=>{
      var max_width = $("#search_option").width()
      $("#search_option button").css("max-width",max_width-10)
      $("#search_option button .filter-option").addClass("hide_long_text")
      var max_width = $("#sort_option").width()
      $("#sort_option button").css("max-width",max_width-10)
      $("#sort_option button .filter-option").addClass("hide_long_text")
    },100)
      var trip_id_array = new Array();
      var interval;
      
       $('#start_date').datepicker({
         format: 'yyyy-mm-dd',
        <% if(filter_end_date){ %>
          endDate: new Date("<%= filter_end_date %>")
        <% }else{ %>
        endDate: new Date(Date.now())
        <% } %>   

       }).on("input change", function (e) { 
        var end_date = $('#start_date').datepicker('getDate');
        end_date.setDate(end_date.getDate() + 1);
        $('#end_date').datepicker('setStartDate', end_date);
        $('.datepicker-dropdown').hide()
      });

       $('#end_date').datepicker({
         format: 'yyyy-mm-dd',
     endDate: new Date(Date.now()),
     <% if(filter_start_date){ %>
      startDate: new Date("<%= filter_start_date %>")
     <% } %>

       }).on("input change", function (e) { 
        var start_date = $('#end_date').datepicker('getDate');
        start_date.setDate(start_date.getDate() - 1);
        $('#start_date').datepicker('setEndDate', start_date);

        $('.datepicker-dropdown').hide()
      });


        <% detail.forEach(function(data){ %>
          $("#show_trip_docs<%= data._id %>").click(function(){
          let image_base_url = "<%= setting_detail.image_base_url %>"
          let data = <%- JSON.stringify(data)%>
          $('.trip_docs').empty()
          if(data.corporate_doc && data.corporate_doc.length > 0){
            data.corporate_doc.forEach((image, index) => {
              if(image !== ""){
                const fileExtension = image.split('.').pop().toLowerCase();
                if(fileExtension == "pdf"){
                  $('.trip_docs').append(
                    '<div class="row"><div class="col-md-12"><div class="card mb-3" style="text-align: center;">' +
                      '<div id="pdf-status" class="pdf-uploaded">' +
                        '<i class="fa fa fa-file-pdf-o icon_class" style="font-size: 190px;display: block;"></i>'+
                        '<span class="pdf-uploaded-text">PDF File!</span>'+
                      '</div>'+
                    '<div class="download-wrapper">' +
                    '<form method="get" target="_blank" action="' +
                    image_base_url +
                    image +
                    '">' +
                    '<a href="' +
                    image_base_url +
                    image +
                    '" download>' +
                    '<i class="fa fa-download icon_class"></i>' +
                    '</a>' +
                    '</form>' +
                    '</div>' +
                    '</div>' +
                    '<div class="card-body"><h5 class="card-title">Doc '+(index + 1)+'</h5></div></div></div></div>'
                  );
                }else{
                  $('.trip_docs').append(
                    '<div class="row"><div class="col-md-12"><div class="card mb-3">' +
                    '<div class="image-container1">' +
                    '<img src=' +
                    image_base_url +
                    image +
                    ' class="card-img-top img-fluid image-container">' +
                    '<div class="download-wrapper">' +
                    '<form method="get" target="_blank" action="' +
                    image_base_url +
                    image +
                    '">' +
                    '<a href="' +
                    image_base_url +
                    image +
                    '" download>' +
                    '<i class="fa fa-download icon_class"></i>' +
                    '</a>' +
                    '</form>' +
                    '</div>' +
                    '</div>' +
                    '<div class="card-body"><h5 class="card-title">Doc '+(index + 1)+'</h5></div></div></div></div>'
                  )
                }
              }
            })
            $("#show_trip_doc_modal").modal('show');
          }
        })


    $('#see_trip_info_modal_btn<%=data._id%>').click(function(){
      let trip_details = <%-JSON.stringify(data)%>
      trip_id_array.push('<%= data._id %>')
      $('#trip_origin<%=data._id%>').text('<%= data.source_address%>') 
      $('#trip_destination<%=data._id%>').text('<%= data.destination_address%>') 
      if(Array.isArray(trip_details.destination_stops) && trip_details.destination_stops.length > 0){
      $('#dest_stops<%=data._id%>').show()
      trip_details.destination_stops.forEach((element, i) => {
        let stop_address = ""
        stop_address = '<p class="p_style"><%= __('title_stop') %> '+(Number(i)+1)+' : '+element.address+'</p>';
        //$('#dest_stops<%=data._id%>').append(stop_address);          
      })
    }else{
      $('#dest_stops<%=data._id%>').empty()
      $('#dest_stops<%=data._id%>').hide()
    }

      
      if(
        '<%= data.pickup_details %>' && 
        '<%= data.pickup_details[0].user_details.no_of_helpers != "" %>' &&
        '<%= data.pickup_details[0].user_details.no_of_helpers != "0" %>'
      ) {
        $('#helpers_load<%=data._id%>').show();
        $('#helpers_load<%=data._id%>').text("<%= data.pickup_details[0].user_details.number_of_helpers_load %>"); 
        $('#helpers_download<%=data._id%>').show();
        $('#helpers_download<%=data._id%>').text("<%= data.pickup_details[0].user_details.number_of_helpers_download %>"); 
      } else {
        $('#helpers_load<%=data._id%>').hide();
        $('#helpers_download<%=data._id%>').hide();
      }
      let country_id = trip_details.country_id
      let trip_country = countries.find(country => country._id === country_id);
      if(trip_country.countryname == "Panama"){
        let procedure = trip_details.selected_procedure || ""
        procedure = procedure == "<%=PROCEDURE_TYPE.GENERAL_MERCHANDISE%>" ? "<%= __('title_general_mechandise')%>" : procedure == "<%=PROCEDURE_TYPE.FISCAL_TI_MERCHANDISE%>" ? "<%= __('title_fiscal_ti_merchandise')%>" : procedure == "<%=PROCEDURE_TYPE.LIQUIDAR_MERCHANDISE%>" ? "<%= __('title_merchandise_liquidar')%>" : ""
        let transit_service = trip_details.selected_transit_service || ""
        transit_service = transit_service == "<%=BOOLEAN_TYPE.YES%>" ? "<%= __('title_yes')%>" : transit_service == "<%=BOOLEAN_TYPE.NO%>" ? "<%= __('title_no')%>" : ""
        $('#trip_type_procedure<%=data._id%>').text(procedure) 
        $('#trip_transit_service_type<%=data._id%>').text(transit_service) 
        $('#trip_transit_number<%=data._id%>').text(trip_details.selected_transit_type_number || "") 
        $('.trip_type_procedure<%=data._id%>').show()
        $('.trip_transit_service_type<%=data._id%>').show()
        $('.trip_transit_number<%=data._id%>').show()
      }else{
        $('.trip_type_procedure<%=data._id%>').hide()
        $('.trip_transit_service_type<%=data._id%>').hide()
        $('.trip_transit_number<%=data._id%>').hide()
      }

      if('<%= data.server_start_time_for_schedule%>'){
        $('#trip_start_date<%=data._id%>').text(moment('<%= data.server_start_time_for_schedule%>').tz('<%=timezone_for_display_date %>').format("DD MMM 'YY")) 
        $('#trip_start_time<%=data._id%>').text(moment('<%= data.server_start_time_for_schedule%>').tz('<%=timezone_for_display_date %>').format("hh:mm a")) 
      }else{
        $('#trip_start_date<%=data._id%>').text(moment('<%= data.created_at%>').tz('<%=timezone_for_display_date %>').format("DD MMM 'YY")) 
        $('#trip_start_time<%=data._id%>').text(moment('<%= data.created_at%>').tz('<%=timezone_for_display_date %>').format("hh:mm a")) 
      }
      // if(trip_details.destination_addresses.length > 0){
      //   $('#stop_details_data<%=data._id%>').show()
      //   $('#stop_details_data<%=data._id%>').empty()
      //   trip_details.destination_addresses.forEach((element, i) => {
      //     stop_address = ""
      //     let stop = element.stops_inside ? element.stops_inside.length : element.inside_stops
      //     stop_address = '<p class="sub_h_style"><%= __("title_details_modal") %> '+(Number(i)+1)+'</p>'+
      //     '<p class="p_style" >'+element.address+'</p>';
      //     $('#stop_details_data<%=data._id%>').append(stop_address);
      //     if(element.stops_inside){
      //       element.stops_inside.forEach((stop, i) => {
      //         stop_address = '<p class="p_style"><%= __('title_stop') %> '+(Number(i)+1)+' : '+stop.address+'</p>';
      //         $('#stop_details_data<%=data._id%>').append(stop_address);
      //       })
      //     }
          
      //   })
      // }else{
      //   $('#stop_details_data<%=data._id%>').empty()
      //   $('#stop_details_data<%=data._id%>').hide()
      // }
      if (trip_details.destination_addresses.length > 0) {
          $('#stop_details_data<%=data._id%>').show();
          $('#stop_details_data<%=data._id%>').empty();
          trip_details.destination_addresses.forEach((element, i) => {
              let stop_address = `
                  <p class="h_style" style="text-align: center; color: rgb(0 191 179); font-size: 17px; font-weight: 600;">
                      <b><%= __("title_details_modal") %> ${(Number(i) + 1)}</b>
                  </p>
                  <p class="p_style">${element.address} <br>`;
              if (element.stop_username && element.stop_username.trim() !== '') {
                  stop_address += `<b><%= __("title_user_stop") %></b> ${element.stop_username} <br>`;
              }
              if (element.stop_user_phone && element.stop_user_phone.length > 0) {
                  stop_address += `<b><%= __("title_phone_stop") %></b> ${element.stop_user_phone.join(', ')} <br>`;
              }
              stop_address += '</p>';
              $('#stop_details_data<%=data._id%>').append(stop_address);
              if (element.stops_inside) {
                  element.stops_inside.forEach((stop, j) => {
                      stop_address = `
                          <p class="p_style">
                              <b><%= __('title_stop') %> ${(Number(j) + 1)}</b>: ${stop.address}
                          </p>`;
                      $('#stop_details_data<%=data._id%>').append(stop_address);
                  });
              }
          });
      }else{
        $('#stop_details_data<%=data._id%>').empty()
        $('#stop_details_data<%=data._id%>').hide()
      }
      let service_details = trip_details.service_details
      if(service_details){
        $('#trip_selected_service<%=data._id%>').text(service_details.service_name) 
      }
      if(trip_details.pickup_details[0].weight_of_load){
        $('#trip_weight_load<%=data._id%>').text(trip_details.pickup_details[0].weight_of_load + " Kg") 
      }
      $('#trip_volume_load<%=data._id%>').text(trip_details?.pickup_details[0]?.volume_of_load ? trip_details?.pickup_details[0]?.volume_of_load + " M3" : "") 
      $('#pickup_company_name<%=data._id%>').text("")
      $('#pickup_name<%=data._id%>').text("")
      $('#pickup_phone<%=data._id%>').text("")
      $('#pickup_weight_of_load<%=data._id%>').text("")
      $('#pickup_description<%=data._id%>').text("")
      if(trip_details.pickup_details.length){
        const pickup = trip_details.pickup_details[0]
        const user = pickup.user_details
        $('#pickup_company_name<%=data._id%>').text(user.company_name)
        $('#pickup_name<%=data._id%>').text(user.name)
        $('#pickup_phone<%=data._id%>').text( user.phone)
        $('#pickup_weight_of_load<%=data._id%>').text(pickup.weight_of_load)
        $('#pickup_description<%=data._id%>').text(pickup.note)
      }

      $('#delivery_company_name<%=data._id%>').text("")
      $('#delivery_name<%=data._id%>').text("")
      $('#delivery_phone<%=data._id%>').text("")
      $('#delivery_description<%=data._id%>').text("")
      if(trip_details.delivery_details.length){
        const delivery = trip_details.delivery_details[0]
        const user = delivery.user_details
        $('#delivery_company_name<%=data._id%>').text(user.company_name)
        $('#delivery_name<%=data._id%>').text(user.name)
        $('#delivery_phone<%=data._id%>').text( user.phone)
        $('#delivery_description<%=data._id%>').text(delivery.note)
      }

      
      let model_details = trip_details.model_details
      if(model_details){
        $('#trip_vehicle_model<%=data._id%>').text(model_details.model_name) 
      }
      let capacity_details = trip_details.capacity_details
      if(capacity_details){
        let unit = capacity_details?.unit
        unit = unit == 0 ? 'Kilos' : unit == 1 ? 'Litre' : unit == 2 ? 'm3' : ""
        let capacity_name = capacity_details?.capacity_name ? capacity_details?.capacity_name : capacity_details?.value
        $('#trip_selected_capacity<%=data._id%>').text(capacity_name + " " + unit ) 
      }

      $('#trip_selected_type<%=data._id%>').text('<%= data.type_detail.typename%>') 
      
      $('#trip_total<%=data._id%>').text('$'+(Number('<%= data.provider_service_fees%>')).toFixed(2)) 
      
      $('#count_night_shift<%=data._id%>').text('<%= data.night_shift%>') 
      let message = '<%= __('title_yes') %>';
      if(Number('<%= data.boat_ticket %>') == 0) {
        message = '<%= __('title_no') %>';
      }
      $('#ferry_ticket<%=data._id%>').text(message) 

      $('#trip_details_modal<%=data._id%>').modal('show');
      
      $('#trip_load_images<%=data._id%>').hide()
      $('#trip_load_images<%=data._id%>').empty()
      if(trip_details.image_url.length){
            const image_base_url = "<%= setting_detail.image_base_url %>"
            trip_details.image_url.forEach((image, index) => {
              if(image !== ""){
                const fileExtension = image.split('.').pop().toLowerCase();
                if(fileExtension == "pdf"){
                  $('#trip_load_images<%=data._id%>').append(
                    '<div class="row"><div class="col-md-12"><div class="card mb-3" style="text-align: center;">' +
                    '<div id="pdf-status" class="pdf-uploaded">' +
                      '<i class="fa fa fa-file-pdf-o icon_class" style="font-size: 190px;display: block;"></i>'+
                      '<span class="pdf-uploaded-text">PDF File!</span>'+
                    '</div>'+
                    '<div class="download-wrapper">' +
                    '<form method="get" target="_blank" action="' +
                    image_base_url +
                    image +
                    '">' +
                    '<a href="' +
                    image_base_url +
                    image +
                    '" download>' +
                    '<i class="fa fa-download icon_class"></i>' +
                    '</a>' +
                    '</form>' +
                    '</div>' +
                    '</div>' +
                    '<div class="card-body"><h5 class="card-title">Doc '+(index + 1)+'</h5></div></div></div></div>'
                  );
                }else{
                  $('#trip_load_images<%=data._id%>').append(
                    '<div class="row"><div class="col-md-12"><div class="card mb-3">' +
                    '<div class="image-container1">' +
                    '<img src=' +
                    image_base_url +
                    image +
                    ' class="card-img-top img-fluid image-container">' +
                    '<div class="download-wrapper">' +
                    '<form method="get" target="_blank" action="' +
                    image_base_url +
                    image +
                    '">' +
                    '<a href="' +
                    image_base_url +
                    image +
                    '" download>' +
                    '<i class="fa fa-download icon_class"></i>' +
                    '</a>' +
                    '</form>' +
                    '</div>' +
                    '</div>' +
                    '<div class="card-body"><h5 class="card-title">Doc '+(index + 1)+'</h5></div></div></div></div>'
                  );
                }
              }
            })
    
            $('#trip_load_images<%=data._id%>').show()
          }
    })
        trip_id_array.push('<%= data._id %>')

        <% }); %>

        var $form = $('#partner_book_trip_request_form');
        $form.submit(function(event) {
          event.preventDefault();
          var trip_id = $("#trip_id").val();
          $.ajax({
            url: 'partner_book_trip_request_btn',
            data: $('#partner_book_trip_request_form').serialize(),
            dataType: "json",
            type: 'post',
            success: function(res){
              if(res.success){
                location.reload()
                setTimeout(function () {
                    $('#promo_error').hide();
                }, 3000);
              }else{
                location.reload()
                setTimeout(function () {
                    $('#promo_error').hide();
                }, 3000);

              }
            }
          });
        })





       if(trip_id_array.length >0)
       {
          clearInterval(interval);
          interval = setInterval(function () {
            $.ajax({
                type: 'POST',
                url: '/requsest_status_ajax',
                data: {'trip_id_array':trip_id_array},
                dataType: "json",
                success: function (res) {
                  res.forEach(function(trip_data){

                    $('#provider'+trip_data.trip_detail._id).html(trip_data.provider);
                    $('#pr_name'+trip_data.trip_detail._id).html(trip_data.provider);

                    if(trip_data.trip_detail.is_trip_cancelled == 1)
                    {
                      if(trip_data.trip_detail.is_trip_cancelled_by_provider == 1)
                      {
                        $('#'+trip_data.trip_detail._id).html('<span class="label label-danger"><%= __('title_total_cancelled_by_provider') %></span>');
                      }
                      else if(trip_data.trip_detail.is_trip_cancelled_by_user == 1)
                      {
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-danger"><%= __('title_total_cancelled_by_user') %></span>');
                      }
                      else
                      {
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-danger"><%= __('title_total_cancelled') %></span>');
                      }
                    }
                    else
                    {
                      if(trip_data.trip_detail.is_provider_status == 2)
                      {
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-warning"><%= __('title_trip_status_coming') %></span>');
                      }
                      else if(trip_data.trip_detail.is_provider_status == 4)
                      {
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-info"><%= __('title_trip_status_arrived') %></span>');
                      }
                      else if(trip_data.trip_detail.is_provider_status == 6)
                      {
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-info"><%= __('title_trip_status_trip_started') %></span>');
                      }
                      else if(trip_data.trip_detail.is_provider_status == 7){
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-info"><%= __('title_trip_status_arrived_at_destination') %></span>');
                      }
                      else if(trip_data.trip_detail.is_provider_status == 9)
                      {
                          $('#'+trip_data.trip_detail._id).html('<span class="label label-success"><%= __('title_trip_status_completed') %></span>');
                          $('#amount'+trip_data.trip_detail._id).html(trip_data.trip_detail.total);
                          if(trip_data.trip_detail.payment_status == 0)
                          {
                              $('#payment_status'+trip_data.trip_detail._id).html('<span class="label label-warning"><%= __('title_pending') %></span>');
                          }
                          else
                          {
                            if(trip_data.trip_detail.payment_status == 1)
                            {
                                $('#payment_status'+trip_data.trip_detail._id).html('<span class="label label-success"><%= __('title_paid') %></span>');
                            }
                            else
                            {
                                $('#payment_status'+trip_data.trip_detail._id).html('<span class="label label-danger"><%= __('title_not_paid') %></span>');
                            }
                          }
                          
                      }
                      else if(trip_data.trip_detail.is_provider_status == 1 || trip_data.trip_detail.is_provider_status == 0)
                      {
                          if(trip_data.trip_detail.is_provider_accepted == 1)
                          {
                            $('#'+trip_data.trip_detail._id).html('<span class="label label-info"><%= __('title_accepted_request') %></span>');
                          } 
                          else
                          {
                            $('#'+trip_data.trip_detail._id).html('<span class="label label-info"><%= __('title_trip_status_waiting') %></span>');
                          }
                      }
                    }
                  })
                }
            });
          },10000);
       }
   
 });

 $('#show_trip_book_details_btn').click(function(){
  $('#trip_origin').text(trip_details.source_address) 
  $('#trip_destination').text(trip_details.destination_address) 

  if(trip_details.server_start_time_for_schedule){
    $('#trip_start_date').text(moment(trip_details.server_start_time_for_schedule).format("DD MMM 'YY")) 
    $('#trip_start_time').text(moment(trip_details.server_start_time_for_schedule).format("hh:mm a")) 
  }else{
    $('#trip_start_date').text(moment(trip_details.created_at).format("DD MMM 'YY")) 
    $('#trip_start_time').text(moment(trip_details.created_at).format("hh:mm a")) 
  }
  if(trip_details.service_details){
    $('#trip_selected_service').text(trip_details.service_details.service_name) 
  }
  $('#trip_selected_type').text(city_type.typename) 
  // $('#trip_detail').text(trip_details.destination_address) 
  if(
    trip_details.pickup_details && 
    trip_details.pickup_details[0].user_details.no_of_helpers != "" &&
    trip_details.pickup_details[0].user_details.no_of_helpers != "0"
    ) {
      $('#helpers_load').show();
      $('#helpers_load').text(trip_details.pickup_details[0].user_details.number_of_helpers_load); 
      $('#helpers_download').show();
      $('#helpers_download').text(trip_details.pickup_details[0].user_details.number_of_helpers_download); 
    } else {
      $('#helpers_load').hide();
      $('#helpers_download').hide();
      $('#helpers_load').text("");
      $('#helpers_download').text("");
    }

  
  let selected_vehicle_id = $("#available_vehicles").val()
  let index1 = available_vehicles.findIndex(x => (x._id).toString() == selected_vehicle_id.toString());
  let helpers_list = $('#helpers_list').val()
  $('#confirm_helpers').val(JSON.stringify(helpers_list))
  let capacity_details = trip_details.capacity_details
  if(capacity_details){
    let unit = capacity_details?.unit
    unit = unit == 0 ? 'Kilos' : unit == 1 ? 'Litre' : unit == 2 ? 'm3' : ""
    let capacity_name = capacity_details?.capacity_name ? capacity_details?.capacity_name : capacity_details?.value
    $('#trip_selected_capacity').text(capacity_name + " " + unit ) 
  }

  if(trip_details.model_type && (trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.GANDOLA %>") || trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.CHUTO %>") || trip_details.model_type == Number('<%= MODEL_TRUCK_TYPE.CABEZAL %>'))){
    let selected_vehicle_id_2 = $("#available_vehicles_2").val()
    let vehicle2_index = available_trailers.findIndex(x => (x._id).toString() == selected_vehicle_id_2.toString());
    if(vehicle2_index != -1){
      $('#confirm_vehicle_id_2').val(available_trailers[vehicle2_index]._id)
      if(selected_vehicle_id.toString() == selected_vehicle_id_2.toString()){
        $('#message1').show();
        setTimeout(function () {
          $('#message1').hide();
      }, 3000);
      return
    }
    if(trip_details.model_details){
      $('#trip_vehicle_model_2').text(trip_details.model_details.model_name) 
    }
    $('#trip_vehicle_type_2').text(city_type.typename) 
    $('#trip_vehicle_plateno_2').text(available_trailers[vehicle2_index].plate_no) 
    $('.vehicle_2_details').show();
  }

  }else{
    $('.vehicle_2_details').hide();

  }

  if(trip_details.model_details){
    $('#trip_vehicle_model').text(trip_details.model_details.model_name) 
  }
  $('#trip_vehicle_type').text(city_type.typename) 
  $('#confirm_vehicle_id').val(available_vehicles[index1]._id) 

  $('#trip_vehicle_plateno').text(available_vehicles[index1].plate_no) 
  let selected_driver_id = $("#available_drivers").val()
  let index2 = available_drivers.findIndex(x => (x._id).toString() == selected_driver_id.toString());
  
  $('#confirm_provider_id').val(available_drivers[index2]._id) 
  $('#confirm_trip_id').val(trip_details._id) 
  
  $('#trip_assigned_driver').text(available_drivers[index2].first_name +' ' + available_drivers[index2].last_name) 
  $('#trip_driver_phone').text(available_drivers[index2].phone) 
  $('#trip_driver_uniqueid').text(available_drivers[index2].unique_id) 

  $('#trip_total').text('$'+trip_details.provider_service_fees) 

  $('#book_trip_details_modal').modal('show');

 })

 $('#book_req_btn').click(function(){
  
  let id = $('#book_req_id').val() 
  assign_vehicle_driver(id)
 })
 function assign_vehicle_driver(trip_id){
    let id = trip_id;
    $.ajax({
      type: 'POST',
      url: '/get_driver_vehicle_for_trip',
      data: {trip_id: id},
      dataType: "json",
      success: function (res) {

        if(res.success){
          
          trip_details = res.trip_details
          city_type = res.city_type
          available_vehicles = res.available_vehicles || []
          available_trailers = res.available_trailers || []
          available_drivers = res.available_drivers
          timezone_for_display_date = res.timezone_for_display_date
          // moment = res.moment
          $('#available_drivers').empty();
          $("#available_drivers").append('<option style="display: none" selected><%= __('title_select_driver') %></option>')

          $('#available_vehicles').empty();
          $("#available_vehicles").append('<option style="display: none" selected><%= __('title_select_vehicle') %></option>')

          res.available_vehicles.forEach(function (vehicle) {
            let vehicle_name = vehicle.name;
            let vehicle_id = vehicle._id;
            $("#available_vehicles").append("<option value="+vehicle_id + ">"+ vehicle_name+ "</option>");
          });
          $('#available_vehicles').selectpicker('refresh');
          if(trip_details.model_type && (trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.GANDOLA %>") || trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.CHUTO %>") ||  trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.CABEZAL %>"))){
            $(".vehicle_selection_2").show();
            $('#available_vehicles_2').empty();
            $("#available_vehicles_2").append('<option style="display: none" selected><%= __('title_select_vehicle_2') %></option>')
            available_trailers.forEach(function (vehicle) {
              let vehicle_name = vehicle.name;
              let vehicle_id = vehicle._id;
              $("#available_vehicles_2").append("<option value="+vehicle_id + ">"+ vehicle_name+ "</option>");
            });
            $('#available_vehicles_2').selectpicker('refresh');
          }else{
            $(".vehicle_selection_2").hide();
          }
          

          res.available_drivers.forEach(function (provider) {
            var provider_name = provider.first_name +' '+ provider.last_name;
            var provider_id = provider._id;
            $("#available_drivers").append("<option value="+provider_id + ">"+ provider_name+ "</option>");
          });
          $('#available_drivers').selectpicker('refresh');
         
          if(trip_details.pickup_details[0].user_details.no_of_helpers != "" && Number(trip_details.pickup_details[0].user_details.no_of_helpers) != 0){
            $('#helpers_list_div').show();
          }else{
            $('#helpers_list_div').hide();
          }

          $('#assign_driver_vehicle_modal').modal('show');
        } 
      }
    });
  } 
  

  var URL = window.location.protocol + '//'+ window.location.hostname;
  var socket = io.connect(URL);


  socket.on('connect',function() {
  });

  function emit_data(tripid){
    socket.emit('trip_detail_notify', {trip_id: tripid})
  }

  socket.on('disconnect',function() {
  });

  function unassign_trip(id) {
    if (!window.confirm("<%= __('confirm_unassign_trip_message')%>")) {
      return false;
    }
    $("#unassignReasonForm").trigger("reset");
    $('#unassign_trip_id').val(id); 
    $('#unassignReasonModal').modal('show');
  }

  $('input[name="unassign_reason"]').on('change', function () {
    if ($(this).val() === 'Other') {
      $('#other_reason_container').show();
      $('#unassign_reason_other').attr('required', true);
    } else {
      $('#other_reason_container').hide();
      $('#unassign_reason_other').removeAttr('required');
    }
  });

  var $form = $('#unassignReasonForm');

  $form.submit(function (event) {
    event.preventDefault();

    let selectedReason = $('input[name="unassign_reason"]:checked').val();
    let otherReason = $('#unassign_reason_other').val().trim();
    let trip_id = $('#unassign_trip_id').val()
    let unassign_reason = selectedReason === "Other" ? otherReason : selectedReason;

    if (!unassign_reason || (unassign_reason == "Other" && otherReason != "")) {
      alert('Please enter or select a reason.');
      return;
    }
    $('#unassignReasonForm input[type="submit"]').attr('disabled', 'disabled');

    let reasonInput = $('<input>').attr({
      type: 'hidden',
      name: 'unassign_reason',
      value: unassign_reason
    });

    $form.append(reasonInput);

    $.ajax({
      type: 'POST',
      url: '/partner_unassign_trip',
      data: {trip_id, unassign_reason},
      dataType: "json",
      success: function (res) {
        if (res.success) {
          trip_error(res.message)
          $('#unassignReasonModal').modal('hide');
          setTimeout(() => {
            location.reload();
          }, 2000);
        }
      },
      complete: function () {
        $('#unassignReasonForm input[type="submit"]').removeAttr('disabled');
      }
    });
  });
  
  $("#unassignReasonForm").validate({
    rules: {
      unassign_reason: "required",
    }
  });

  function get_available_drivers_vehicles(trip_id, change_type){
    $("#change_driver_form").trigger("reset");
    let id = trip_id;
    $.ajax({
      type: 'POST',
      url: '/get_available_driver_vehicle_for_partner',
      data: {trip_id: id, change_type},
      dataType: "json",
      success: function (res) {
        if(res.success){
          trip_details = res.trip_details
          timezone_for_display_date = res.timezone_for_display_date
          $("#change_driver_trip_id").val(id);
          $("#change_type").val(change_type);
          if(change_type == "provider"){
            $('#change_drivers_list').empty();
            $('.change_drivers_list').show();
            $("#change_drivers_list").append('<option style="display: none" selected><%= __('title_select_driver') %></option>')
            available_drivers = res.available_drivers
            available_drivers.forEach(function (provider) {
              const provider_name = provider.first_name +' '+ provider.last_name;
              const provider_id = provider._id;
              $("#change_drivers_list").append("<option value="+provider_id + ">"+ provider_name+ "</option>");
            });
            $('#change_drivers_list').selectpicker('refresh');
            
            $('#change_vehicle_list').empty();
            $('.change_vehicle_list').hide();
            
            $(".change_vehicle_selection_2").hide();
            $('#change_vehicle_list_2').empty();
            
          
            // if(trip_details.pickup_details[0].user_details.no_of_helpers != "" && Number(trip_details.pickup_details[0].user_details.no_of_helpers) != 0){
            //   $('#helpers_list_div').show();
            // }else{
            //   $('#helpers_list_div').hide();
            // }
  
          }else{
            city_type = res.city_type
            available_vehicles = res.available_vehicles || []
            available_trailers = res.available_trailers || []
            $('#change_vehicle_list').empty();
            $('.change_vehicle_list').show();
            $('#change_drivers_list').empty();
            $('.change_drivers_list').hide();
            $("#change_vehicle_list").append('<option style="display: none" selected><%= __('title_select_vehicle') %></option>')
            available_vehicles.forEach(function (vehicle) {
              let vehicle_name = vehicle.name;
              let vehicle_id = vehicle._id;
              $("#change_vehicle_list").append("<option value="+vehicle_id + ">"+ vehicle_name+ "</option>");
            });
            $('#change_vehicle_list').selectpicker('refresh');
            if(trip_details.model_type && (trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.GANDOLA %>") || trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.CHUTO %>") ||  trip_details.model_type == Number("<%= MODEL_TRUCK_TYPE.CABEZAL %>"))){
              $(".change_vehicle_selection_2").show();
              $('#change_vehicle_list_2').empty();
              $("#change_vehicle_list_2").append('<option style="display: none" selected><%= __('title_select_vehicle_2') %></option>')
              available_trailers.forEach(function (vehicle) {
                let vehicle_name = vehicle.name;
                let vehicle_id = vehicle._id;
                $("#change_vehicle_list_2").append("<option value="+vehicle_id + ">"+ vehicle_name+ "</option>");
              });
              $('#change_vehicle_list_2').selectpicker('refresh');
            }else{
              $(".change_vehicle_selection_2").hide();
            }
          }
          $('#change_driver_vehicle_modal').modal('show');

          // moment = res.moment
        } 

        // if(res.success){
        //   available_drivers = res.available_drivers
        //   $('#change_drivers_list').empty();
        //   $("#change_drivers_list").append('<option style="display: none" selected><%= __('title_select_driver') %></option>')
        //   res.available_drivers.forEach(function (provider) {
        //     var provider_name = provider.first_name +' '+ provider.last_name;
        //     var provider_id = provider._id;
        //     $("#change_drivers_list").append("<option value="+provider_id + ">"+ provider_name+ "</option>");
        //   });
        //   $('#change_drivers_list').selectpicker('refresh');
        //   $('#change_driver_vehicle_modal').modal('show');
        // } 
      }
    });
  }

  var $form = $('#change_driver_form');
    $form.submit(function(event) {
      event.preventDefault();
      $.ajax({
        url: 'partner_change_driver',
        data: $('#change_driver_form').serialize(),
        dataType: "json",
        type: 'post',
        success: function(res){
          if(res.success){
            location.reload()
          }
        }
      });
    })

  $("#change_driver_form").validate({
    rules: {
      selected_driver_id: "required",
      change_driver_reason: "required",
    }
  });

  function export_excel(){
    $.ajax({
      type: 'POST',
      url: '/genetare_request_excel',
      data: $('.form-horizontal').serialize(),
      dataType: "json",
      success: function (res) {
          window.open(res)
      }
    });
  }

  function get_user_details(trip_id, user_id){
    $.ajax({
      type: 'POST',
      url: '/partner_get_user_details',
      data: {trip_id: trip_id},
      dataType: "json",
      success: function (res) {
        $('#corporate_details'+user_id).empty()
        if(res.success){
          $('#corporate_details'+user_id).append(
            '<p><span class="static-text"><%= __('title_corporate_name') %>: </span><span class="dynamic-text">'+ res.corporate.name+ '</span></p>' 
          )
          $('#userDetailsModal'+user_id).modal('show')
        }else{
          $('#userDetailsModal'+user_id).modal('show')
        }
      }
    });
  }

  function trip_error(message){
    $('#request_error').show();
    $('#request_message').text(message);
    setTimeout(function () {
        $('#request_error').hide();
    }, 3000);
  }

</script>  
<% include footer_list.html %>